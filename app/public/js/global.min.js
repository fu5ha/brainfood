function assignAll(){var t=$(".bag-select").first().prop("selectedIndex");$(".bag-select").prop("selectedIndex",t)}function submitAllSchools(){$.getJSON("/api/schools",function(t){for(var e=t,o=0;o<e.length;o++){var n=e[o];schoolSubmitted(n._id)}})}function schoolSubmitted(t){globals.order.trigger("school-submitted",t)}function removeInventory(t,e){var o={};$.getJSON("/api/school/"+t,function(t){o=t;for(var n=o.bags,a=o.bag,i=[],r=!0,s=[],c=[],l=0;l<a.items.length;l++){var u=$.getJSON("/api/item/"+a.items[l].item._id,function(t){s.push(t)});c.push(u)}$.when.apply(null,c).done(function(){for(var t=0;t<s.length;t++){var o=s[t],c=a.items[t].number,l=c*n,u=o.stock-l;if(0>u)alert('There is insufficient stock of "'+o.name+'" to make the order. '+Math.abs(u)+" more are needed."),r=!1;else{var g={id:o._id,total:u};i.push(g)}}if(r)for(var t=0;t<i.length;t++)$.ajax({url:"/api/item/"+i[t].id,type:"PUT",data:JSON.stringify({stock:i[t].total}),contentType:"application/json",success:function(t){e(!0)},error:function(){e(!1)}})})})}function removeSchool(t){$.ajax({url:"/api/school/"+t,type:"DELETE",success:function(t){var e=function(){globals.order.update()};globals.order.trigger("renewData",e)}})}function submitSchool(t,e){var o={};$.getJSON("/api/bag/"+e,function(e){o=e,$.ajax({url:"/api/school/"+t,type:"PUT",data:JSON.stringify({bag:o}),contentType:"application/json",success:function(e){var o=function(e){e&&removeSchool(t)};removeInventory(t,o)}})})}function orderMounted(t){var e=[];$.getJSON("/api/schools",function(o){e.push(o),$.getJSON("/api/bags",function(o){e.push(o),t.trigger("data_loaded",e)})}),globals.order=t,$("order").hide()}function inventoryMounted(t){$.getJSON("/api/items",function(e){t.trigger("data_loaded",e)}),globals.inventory=t}function renewOrderData(t){var e=[];$.getJSON("/api/schools",function(o){e[0]=o,$.getJSON("/api/bags",function(o){e[1]=o,t(e)})})}function renewData(t){$.getJSON("/api/items",function(e){t(e)})}function bagviewMounted(t){globals.bagview=t}function addItemToBag(t){$.getJSON("/api/item/"+t,function(t){globals.bagview.trigger("item-added",t)})}function deleteSelected(){globals.inventory.trigger("delete-selected")}function deleteItem(t){$.ajax({url:"api/item/"+t,type:"DELETE",success:function(t){}});var e=function(){globals.inventory.trigger("stock-changed")};globals.inventory.trigger("renewData",e)}function quantityChanged(t){globals.bagview.trigger("quantity-changed",t)}function removeItemFromBag(t){globals.bagview.trigger("remove-item",t)}function saveBagToDatabase(t,e){for(var o=!0,n=0;n<globals.bags.length;n++)globals.bags[n].name===t.name&&(o=!1);o?($.ajax({url:"api/bags",type:"POST",data:JSON.stringify(t),contentType:"application/json",success:function(t){e(!0)},error:function(){e(!1)}}),$.getJSON("/api/bags",function(t){globals.bags=t})):$.ajax({url:"api/bag/name/"+t.name,type:"PUT",data:JSON.stringify(t),contentType:"application/json",success:function(t){e(!0)},error:function(){e(!1)}})}function createNewItem(t,e){$.ajax({url:"api/items",type:"POST",data:JSON.stringify(t),contentType:"application/json",success:function(t){var o=function(){globals.inventory.trigger("stock-changed")};globals.inventory.trigger("renewData",o),e(!0)},error:function(){e(!1)}})}function createNewSchool(t,e){$.ajax({url:"api/schools",type:"POST",data:JSON.stringify(t),contentType:"application/json",success:function(t){var o=function(){globals.order.update()};globals.order.trigger("renewData",o),e(!0)},error:function(){e(!1)}})}function selectAll(t){globals.inventory.trigger("select-all",t)}function changeStock(t){var e=parseInt(document.getElementById(t+"-stock").value),o=JSON.stringify({stock:e});$.ajax({url:"api/item/"+t,type:"PUT",data:o,contentType:"application/json",success:function(t){}}),globals.inventory.trigger("stock-changed")}var globals={};$(document).ready(function(){riot.mount("inventory",{mounted:inventoryMounted,addItemToBag:addItemToBag,deleteItem:deleteItem,renewData:renewData}),riot.mount("bagview",{mounted:bagviewMounted,saveBagToDatabase:saveBagToDatabase}),riot.mount("new-item",{createNewItem:createNewItem}),riot.mount("order",{mounted:orderMounted,renewData:renewOrderData,submitSchool:submitSchool}),riot.mount("new-school",{createNewSchool:createNewSchool}),$.getJSON("/api/bags",function(t){globals.bags=t}),riot.route("inventory"),riot.route(function(t,e,o){if("order"===t){$("inventory").hide(),$("order").show(),$("#new-button").attr("href","#new-school"),$("#new-button button").text("Add School"),$("#top-button").attr("href","#submitall"),$("#top-button button").text("Submit All"),$(".main-bottom-bar button.inventory").hide();var n=function(){globals.order.update()};globals.order.trigger("renewData",n)}else if("inventory"===t){$("order").hide(),$("inventory").show(),$("#new-button").attr("href","#new-item"),$("#new-button button").text("Add Food Item"),$("#top-button").attr("href","#bagView"),$("#top-button button").text("View Bag"),$(".main-bottom-bar button.inventory").show();var n=function(){globals.inventory.trigger("stock-changed")};globals.inventory.trigger("renewData",n)}else"submitall"===t&&submitAllSchools()})});